<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Records Document Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --medical-blue: #1e3a5f;
            --medical-teal: #2c5f6f;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --border-color: #d0d0d0;
            --bg-warm: #fefdfb;
            --accent-red: #c44536;
            --highlight-yellow: #fef3cd;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .upload-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .upload-container h1 {
            font-family: 'Libre Baskerville', serif;
            color: var(--medical-blue);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .upload-container p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 3rem;
            border: 3px dashed var(--border-color);
            border-radius: 8px;
            background: var(--bg-warm);
            transition: all 0.3s ease;
        }

        .file-input-wrapper:hover .file-input-label {
            border-color: var(--medical-blue);
            background: #f8f9fa;
        }

        .file-input-label svg {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            opacity: 0.6;
        }

        .viewer-container {
            display: none;
            max-width: 900px;
            margin: 0 auto;
        }

        .viewer-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viewer-header h2 {
            font-family: 'Libre Baskerville', serif;
            color: var(--medical-blue);
            font-size: 1.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--medical-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--medical-teal);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #e9ecef;
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .document-viewer {
            background: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }

        .document-page {
            background: var(--bg-warm);
            padding: 3rem;
            min-height: 800px;
            border-top: 1px solid var(--border-color);
        }

        /* Medical Document Styling */
        .doc-header {
            border-bottom: 3px solid var(--medical-blue);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        .facility-name {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.8rem;
            color: var(--medical-blue);
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .facility-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .doc-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .meta-item {
            font-size: 0.9rem;
        }

        .meta-label {
            font-weight: 600;
            color: var(--medical-blue);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .meta-value {
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
        }

        .doc-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.1rem;
            color: var(--medical-blue);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-content {
            color: var(--text-primary);
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .vitals-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            background: white;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .vital-item {
            text-align: center;
        }

        .vital-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .vital-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.5rem;
            color: var(--medical-blue);
            font-weight: 500;
        }

        .vital-unit {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-left: 0.25rem;
        }

        .medications-list {
            list-style: none;
            background: white;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .medications-list li {
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .medications-list li:last-child {
            border-bottom: none;
        }

        .medications-list li:before {
            content: "üíä";
            margin-right: 0.75rem;
        }

        .record-type-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--medical-teal);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .emergency-badge {
            background: var(--accent-red);
        }

        .lab-badge {
            background: #2d6a4f;
        }

        .imaging-badge {
            background: #6a4c93;
        }

        .signature-block {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .signature-line {
            margin-top: 3rem;
            border-top: 2px solid var(--text-primary);
            width: 300px;
            padding-top: 0.5rem;
        }

        .signature-name {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            color: var(--text-primary);
        }

        .signature-credentials {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .watermark {
            position: relative;
            margin-top: 2rem;
            padding: 1rem;
            background: var(--highlight-yellow);
            border-left: 4px solid #f9c74f;
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .viewer-header, .controls {
                display: none;
            }
            
            .document-viewer {
                box-shadow: none;
                border-radius: 0;
            }

            .document-page {
                page-break-after: always;
                break-after: page;
                min-height: 100vh;
                padding: 1in;
            }

            .document-page:last-child {
                page-break-after: auto;
            }
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="upload-container" id="uploadContainer">
        <h1>Medical Records Viewer</h1>
        <p>Upload a JSON medical records file to view it as formatted documents.<br>
        This demonstrates how raw medical records appear before data extraction.</p>
        
        <div class="file-input-wrapper">
            <input type="file" id="fileInput" accept=".json">
            <label class="file-input-label" for="fileInput">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <div style="font-weight: 600; color: var(--medical-blue); margin-bottom: 0.5rem;">
                    Drop JSON file here or click to browse
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    Supports medical record JSON files from our test cases
                </div>
            </label>
        </div>
    </div>

    <div class="viewer-container" id="viewerContainer">
        <div class="viewer-header">
            <h2 id="fileName">Medical Records</h2>
            <div class="controls">
                <button class="btn-secondary" id="prevBtn" disabled>‚Üê Previous</button>
                <span class="page-info">
                    Record <span id="currentPage">1</span> of <span id="totalPages">1</span>
                </span>
                <button class="btn-secondary" id="nextBtn">Next ‚Üí</button>
                <button class="btn-primary" id="newFileBtn">Upload New File</button>
            </div>
        </div>
        <div class="document-viewer">
            <div class="document-page" id="documentPage">
                <div class="loading">Loading document</div>
            </div>
        </div>
    </div>

    <script>
        let records = [];
        let currentIndex = 0;
        let isPrintMode = false;

        const uploadContainer = document.getElementById('uploadContainer');
        const viewerContainer = document.getElementById('viewerContainer');
        const fileInput = document.getElementById('fileInput');
        const documentPage = document.getElementById('documentPage');
        const currentPageSpan = document.getElementById('currentPage');
        const totalPagesSpan = document.getElementById('totalPages');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const newFileBtn = document.getElementById('newFileBtn');
        const fileNameDisplay = document.getElementById('fileName');

        fileInput.addEventListener('change', handleFileUpload);
        prevBtn.addEventListener('click', () => navigateRecord(-1));
        nextBtn.addEventListener('click', () => navigateRecord(1));
        newFileBtn.addEventListener('click', resetViewer);

        // Handle print mode - render all records
        window.addEventListener('beforeprint', () => {
            isPrintMode = true;
            renderAllRecords();
        });

        window.addEventListener('afterprint', () => {
            isPrintMode = false;
            renderRecord();
        });

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            fileNameDisplay.textContent = file.name.replace('.json', '');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    records = JSON.parse(e.target.result);
                    if (!Array.isArray(records)) {
                        alert('Invalid JSON format. Expected an array of records.');
                        return;
                    }
                    currentIndex = 0;
                    uploadContainer.style.display = 'none';
                    viewerContainer.style.display = 'block';
                    totalPagesSpan.textContent = records.length;
                    renderRecord();
                } catch (error) {
                    alert('Error parsing JSON file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function navigateRecord(direction) {
            currentIndex += direction;
            currentIndex = Math.max(0, Math.min(currentIndex, records.length - 1));
            renderRecord();
        }

        function renderRecord() {
            const record = records[currentIndex];
            currentPageSpan.textContent = currentIndex + 1;
            
            // Update navigation buttons
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === records.length - 1;

            // Render document
            documentPage.innerHTML = generateDocumentHTML(record);
        }

        function renderAllRecords() {
            let html = '';
            records.forEach((record, index) => {
                html += `<div class="document-page">${generateDocumentHTML(record)}</div>`;
            });
            document.querySelector('.document-viewer').innerHTML = html;
        }

        function resetViewer() {
            uploadContainer.style.display = 'block';
            viewerContainer.style.display = 'none';
            fileInput.value = '';
            records = [];
            currentIndex = 0;
        }

        function getBadgeClass(recordType) {
            const type = recordType.toLowerCase();
            if (type.includes('emergency') || type.includes('ed')) return 'emergency-badge';
            if (type.includes('lab') || type.includes('laboratory')) return 'lab-badge';
            if (type.includes('imaging') || type.includes('radiology') || type.includes('ct') || type.includes('mri') || type.includes('x-ray') || type.includes('ultrasound')) return 'imaging-badge';
            return '';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function generateDocumentHTML(record) {
            const badgeClass = getBadgeClass(record.record_type || '');
            
            let html = `
                <div class="doc-header">
                    <div class="facility-name">${record.facility || 'Medical Facility'}</div>
                    <div class="facility-info">
                        ${record.provider || 'Medical Provider'}<br>
                        Electronic Medical Record System
                    </div>
                </div>

                <div class="record-type-badge ${badgeClass}">
                    ${record.record_type || 'Medical Record'}
                </div>

                <div class="doc-meta">
                    <div class="meta-item">
                        <div class="meta-label">Date of Service</div>
                        <div class="meta-value">${formatDate(record.date)}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Record ID</div>
                        <div class="meta-value">${record.record_id || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Provider</div>
                        <div class="meta-value">${record.provider || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Facility</div>
                        <div class="meta-value">${record.facility || 'N/A'}</div>
                    </div>
                </div>
            `;

            if (record.chief_complaint) {
                html += `
                    <div class="doc-section">
                        <div class="section-title">Chief Complaint</div>
                        <div class="section-content">${record.chief_complaint}</div>
                    </div>
                `;
            }

            if (record.assessment) {
                html += `
                    <div class="doc-section">
                        <div class="section-title">Assessment / History of Present Illness</div>
                        <div class="section-content">${record.assessment}</div>
                    </div>
                `;
            }

            if (record.vitals && Object.keys(record.vitals).length > 0) {
                html += `
                    <div class="doc-section">
                        <div class="section-title">Vital Signs</div>
                        <div class="vitals-grid">
                `;
                
                const vitalsMap = {
                    'blood_pressure': { label: 'Blood Pressure', unit: '' },
                    'heart_rate': { label: 'Heart Rate', unit: 'bpm' },
                    'respiratory_rate': { label: 'Resp. Rate', unit: '/min' },
                    'temperature': { label: 'Temperature', unit: '¬∞F' },
                    'oxygen_saturation': { label: 'O2 Sat', unit: '%' },
                    'weight': { label: 'Weight', unit: 'lbs' },
                    'BMI': { label: 'BMI', unit: '' }
                };

                for (const [key, value] of Object.entries(record.vitals)) {
                    if (value !== undefined && value !== null && value !== '') {
                        const vitalInfo = vitalsMap[key] || { label: key, unit: '' };
                        html += `
                            <div class="vital-item">
                                <div class="vital-label">${vitalInfo.label}</div>
                                <div class="vital-value">
                                    ${value}<span class="vital-unit">${vitalInfo.unit}</span>
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += `
                        </div>
                    </div>
                `;
            }

            if (record.plan) {
                html += `
                    <div class="doc-section">
                        <div class="section-title">Plan / Recommendations</div>
                        <div class="section-content">${record.plan}</div>
                    </div>
                `;
            }

            if (record.medications && record.medications.length > 0) {
                html += `
                    <div class="doc-section">
                        <div class="section-title">Medications</div>
                        <ul class="medications-list">
                `;
                record.medications.forEach(med => {
                    if (med) {
                        html += `<li>${med}</li>`;
                    }
                });
                html += `
                        </ul>
                    </div>
                `;
            }

            html += `
                <div class="signature-block">
                    <div class="signature-line">
                        <div class="signature-name">${record.provider || 'Medical Provider'}</div>
                        <div class="signature-credentials">Electronically Signed: ${formatDate(record.date)}</div>
                    </div>
                </div>

                <div class="watermark">
                    ‚ö†Ô∏è This is a demonstration of how medical records appear before digital processing. 
                    In production, documents like these are converted to structured JSON format for analysis.
                </div>
            `;

            return html;
        }
    </script>
</body>
</html>